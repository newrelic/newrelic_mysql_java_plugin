MySQL plugin for New Relic
==========================

Prerequisites

The MySQL plugin for New Relic requires the following to succesfully install

  1. A New Relic account. Signup for a free account at http://newrelic.com
  2. A server running MySQL Version 5.0 or greater. Download MySQL for free at http://dev.mysql.com/downloads
  3. The MySQL server or another applicable server with a configured Java Runtime (JRE) environment Verion 1.5 or better.

Downloading the MySQL plugin for New Relic

//TODO TODO TODO

  1. Download the New Relic Java SDK from https://github.com/newrelic-platform/newrelic_javaSDK NOTE: Is this subject to change soon!
  2. Download the New Relic plugin for MySQL from https://github.com/newrelic-platform/newrelic_mysql_extension
  3. Download the MySQL Connector/J from http://dev.mysql.com/downloads/connector/j/


Configuring your Agent Environment

The New Relic plugin for MySQL runs an Agent process to collect and report MySQL metrics to New Relic. The following steps
configure this agent for your specific environment.

  1.  New Relic Account License Key
  2.  MySQL privileges
  3.  MySQL properties
  
  
1. New Relic License

Specific your current licence key in the necessary properties file.

 $ cp config/newrelic.properties.example config/newrelic.properties
 # Edit config/newrelic.properties and enter your license key found under Account Settings at https://rpm.newrelic.com

2. MySQL Privileges

When deploying a MySQL plugin on each MySQL server, you require the following MySQL user privileges.

mysql> CREATE USER newrelic@localhost IDENTIFIED BY PASSWORD '*FDAF706717E70DB8DDAD0C5214B13770E1A80B0E';
mysql> GRANT PROCESS,REPLICATION CLIENT ON *.* TO newrelic@localhost;

You can choose to use a different MySQL user name and password if you desire. These are defaults to simplify further installation.

When deploying a MySQL Plugin on a common server, the necessary change is to grant privileges to the applicable hostname,
or host mask, i.e. changing the value of "localhost" in the 2 SQL statements appropriately, e.g. to "10.%" if your servers 
run with this IP range.


3. MySQL Properties

Each running MySQL plugin agent requires a JSON configuration file defining the access to the MySQL instance(s).

 $ cp config/mysql.instance.json.sample config/mysql.instance.json
 # Edit config/mysql.instance.json

If you have configured the Agent to run on the MySQL instance, and used the MySQL user privileges in the 
previous step, you only need to give your MySQL instance a meaningful name.  All other options are default.

 [
    {
        "name"   : "Server/Instance Name",
    }
 ]


You can override all necessary MySQL details. The following is an example syntax.

 [
    {
        "name"       : "Server/Instance Name",
        "host"       : "localhost:3306",
        "user"       : "newrelic",
        "passwd"     : "Your Password Here",
        "properties" : "?profileSQL=true",
        "metrics"    : "status,slave"
    },
  ]
  
  
  
MySQL Metric Categories
 
The New Relic plugin is an extensible architecture, allowing you to define your
own new MySQL metrics that can be obtained via an SQL statement.  As new MySQL 
versions are released, or with additional MySQL third-party storage engines 
addtional information is available for gathering and instrumenting.

Providing an SQL statement can return either a set of rows of key/value results,
or return a single row of many columns with a single value, and those values are 
numeric (a New Relic limitation), the MySQL plugin can record this information 
in New Relic.

The config/metric.category.json file includes the default categories of MySQL metrics
and provides some additional examples for reference.

The obvious commands SHOW GLOBAL STATUS, SHOW MASTER STATUS and SHOW SLAVE STATUS 
satisfy the previous formatting requirements. Additionally commands that select
information from the INFORMATION_SCHEMA, PERFORMANCE_SCHEMA or other tables are possible,
for example in MySQL 5.5 SELECT * FROM INFORMATION_SCHEMA.innodb_buffer_pool_stats and
in MySQL 5.6 SELECT name, count FROM INFORMATION_SCHEMA.innodb_metrics provide additional
information. 

Commands such as SHOW ENGINE INNODB STATUS and SHOW ENGINE INNODB MUTEX are not 
currently supported because they do not fall into the above two categories.

The "metrics" configuration for each MySQL Instance is a CSV list of metric categories 
that are collected for each MySQL Instance.
